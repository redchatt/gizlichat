<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MÉ™xfi Portal | GizliChat</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
        :root { --blue: #3b82f6; --dark: #020617; }
        body, html { margin: 0; padding: 0; height: 100%; overflow: hidden; background: var(--dark); color: white; font-family: 'Segoe UI', sans-serif; }
        #canvas { position: fixed; inset: 0; z-index: -1; }
        
        /* GÄ°RÄ°Åž EKRANI */
        #login { position: fixed; inset: 0; display: flex; justify-content: center; align-items: center; z-index: 100; background: rgba(2,6,23,0.9); backdrop-filter: blur(15px); }
        .box { background: #1e293b; padding: 40px; border-radius: 25px; border: 1px solid var(--blue); width: 300px; text-align: center; box-shadow: 0 0 20px rgba(59,130,246,0.3); }
        input[type="text"], input[type="password"] { width: 100%; padding: 12px; margin: 10px 0; border-radius: 10px; border: 1px solid #334155; background: #020617; color: white; outline: none; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: var(--blue); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; }

        /* CHAT EKRANI */
        #app { display: none; flex-direction: column; height: 100vh; }
        header { padding: 15px; background: #1e293b; border-bottom: 1px solid #334155; text-align: center; font-size: 18px; font-weight: bold; color: var(--blue); }
        #msgs { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; }
        .msg { padding: 12px; border-radius: 15px; background: #334155; max-width: 80%; line-height: 1.4; word-wrap: break-word; }
        .msg.me { align-self: flex-end; background: var(--blue); }
        .msg img, .msg video { max-width: 100%; border-radius: 10px; margin-top: 5px; display: block; }
        
        .bar { padding: 15px; background: #1e293b; display: flex; align-items: center; gap: 8px; border-top: 1px solid #444; }
        .btn-m { font-size: 24px; cursor: pointer; background: none; border: none; color: #94a3b8; outline: none; }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div id="login">
        <div class="box">
            <h2 style="margin-top:0;">GiriÅŸ PortalÄ±</h2>
            <input type="password" id="pIn" placeholder="MÉ™xfi Kodunuz">
            <button onclick="login()">DAXÄ°L OL</button>
        </div>
    </div>

    <div id="app">
        <header id="uName">YÃ¼klÉ™nir...</header>
        <div id="msgs"></div>
        <div class="bar">
            <input type="file" id="fIn" style="display:none;" onchange="upFile(this)">
            <button class="btn-m" onclick="document.getElementById('fIn').click()">ðŸ“·</button>
            <button class="btn-m" id="mic" onmousedown="startS()" onmouseup="stopS()" ontouchstart="startS()" ontouchend="stopS()">ðŸŽ¤</button>
            <input type="text" id="mText" placeholder="Mesaj yazÄ±n..." style="margin:0;">
            <button onclick="send()" style="width: 60px; background: var(--blue); border-radius: 10px; border:none; color:white; font-weight:bold; cursor:pointer;">></button>
        </div>
    </div>

    <script>
        // FIREBASE KONFÄ°QURASÄ°YASI
        const firebaseConfig = {
            apiKey: "AIzaSyDzNOIEJfrKFGzrMzeT0Jaf6OCHBEq_LuA",
            authDomain: "gizlichat-839ce.firebaseapp.com",
            databaseURL: "https://gizlichat-839ce-default-rtdb.europe-west1.firebasedatabase.app/",
            projectId: "gizlichat-839ce"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        // ARXA FON ANÄ°MASÄ°YASI
        const cvs = document.getElementById('canvas');
        const ctx = cvs.getContext('2d');
        let dots = [];
        cvs.width = window.innerWidth; cvs.height = window.innerHeight;
        for(let i=0; i<60; i++) dots.push({x:Math.random()*cvs.width, y:Math.random()*cvs.height, vx:Math.random()-0.5, vy:Math.random()-0.5});
        function anim() {
            ctx.clearRect(0,0,cvs.width,cvs.height); ctx.fillStyle="rgba(59,130,246,0.5)";
            dots.forEach(d=>{ d.x+=d.vx; d.y+=d.vy; if(d.x<0d.x>cvs.width)d.vx*=-1; if(d.y<0d.y>cvs.height)d.vy*=-1; ctx.beginPath(); ctx.arc(d.x,d.y,2,0,Math.PI*2); ctx.fill(); });
            requestAnimationFrame(anim);
        }
        anim();

        let user = "";
        let rec;
        let chunks = [];

        function login() {
            let p = document.getElementById('pIn').value;
            db.ref('users/' + p).once('value', s => {
                if(s.exists()){
                    user = s.val().name;
                    document.getElementById('uName').innerText = "RÉ™is: " + user;
                    document.getElementById('login').style.display='none';
                    document.getElementById('app').style.display='flex';
                    listen();
                } else { alert("SÉ™hv kod! Admin-dÉ™n (Escobar) icazÉ™ alÄ±n."); }
            });
        }

        function send(url = null, type = 'text') {
            let t = document.getElementById('mText').value;
            if(!t && !url) return;
            db.ref('messages').push({ n: user, t: t, m: url, type: type, time: Date.now() });
            document.getElementById('mText').value = "";
        }

        function upFile(input) {
            const file = input.files[0];
            const reader = new FileReader();
            reader.onload = e => send(e.target.result, file.type.startsWith('video') ? 'video' : 'image');
            reader.readAsDataURL(file);
        }

        async function startS() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                rec = new MediaRecorder(stream);
                rec.ondataavailable = e => chunks.push(e.data);
                rec.onstop = () => {
                    const b = new Blob(chunks, { type: 'audio/ogg' });
                    const r = new FileReader();
                    r.onload = e => send(e.target.result, 'audio');
                    r.readAsDataURL(b);
                    chunks = [];
                };
                rec.start(); 
                document.getElementById('mic').style.color = "red";
            } catch(e) { alert("Mikrofon icazÉ™si verilmÉ™di."); }
        }
        
        function stopS() { if(rec && rec.state !== "inactive") { rec.stop(); document.getElementById('mic').style.color = "#94a3b8"; } }

        function listen() {
            db.ref('messages').limitToLast(50).on('child_added', s => {
                let d = s.val();
                let side = d.n === user ? "me" : "";
                let h = <b>${d.n}:</b><br>;
                if(d.t) h += <div>${d.t}</div>;
                if(d.type === 'image') h += <img src="${d.m}">;
                if(d.type === 'video') h += <video controls src="${d.m}"></video>;
                if(d.type === 'audio') h += <audio controls src="${d.m}"></audio>;
                document.getElementById('msgs').innerHTML += <div class="msg ${side}">${h}</div>;
                document.getElementById('msgs').scrollTop = document.getElementById('msgs').scrollHeight;
            });
        }
    </script>
</body>
</html>


